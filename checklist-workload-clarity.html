<!-- ✅ FINAL: Workload Clarity Checklist (Phase 1 Launch-Ready, Single File)
     ✅ UPDATES INCLUDED (ALL 8 ELEMENTS):
     (1) TRUE HARD LOCK: uses inert on #toolMain + global event capture block when locked
     (2) Removed unused plan logic + removed plan column lookup (full_name only)
     (3) Print/PDF is clean: print CSS hides nav/overlays/buttons/FAB/sidebar
     (4) Unsaved / Last saved feedback (with timestamp)
     (5) Fixed sticky disabled bug: explicit enable/disable via syncActionButtons()
     (6) Accessibility: checklist items are keyboard togglable + mobile menu aria-expanded
     (7) Safe DB assumptions: graceful fallbacks + optional table checks (no hard fails)
     (8) Telemetry: logs tool_opened/tool_saved/tool_printed/tool_cleared safely

-->

<!DOCTYPE html>
<html lang="en-GB">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Workload Clarity Checklist | The Employee Playbook</title>

  <!-- Basic metadata -->
  <meta name="description" content="Workload Clarity Checklist — get clear on expectations, priorities and hidden risks. Remove ambiguity and protect yourself from misunderstandings." />
  <meta name="robots" content="index,follow" />

  <!-- ICONS -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <!-- FONTS -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">

  <!-- Favicon -->
  <link rel="icon" type="image/x-icon" href="assets/img/favicon.png">
  <link rel="icon" type="image/png" href="assets/img/favicon.png">

  <!-- THEME PRELOAD (prevents flash; CSS expects body.dark-mode) -->
  <script>
    (function () {
      try {
        const saved = localStorage.getItem('theme'); // "dark" | "light" | null
        const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
        const useDark = saved ? saved === 'dark' : prefersDark;
        if (useDark) document.documentElement.classList.add('preload-dark');
      } catch (e) {}
    })();
  </script>

  <!-- Supabase project config (YOU maintain keys in this file) -->
  <script src="assets/supabase-config.js"></script>

  <style>
    /* ===========================
       ROOT VARIABLES (From Homepage + Canonical Category Colours)
    =========================== */
    :root {
      --primary-white: #FFFFFF;
      --light-gray: #F8F9FA;
      --medium-gray: #E9ECEF;
      --dark-gray: #6C757D;
      --text-dark: #212529;
      --text-medium: #495057;
      --accent-purple: #7B5FC4;
      --accent-purple-dark: #5A4496;
      --light-purple: #E6E0F5;
      --lighter-purple: #F0EBFA;
      --border-light: rgba(0, 0, 0, 0.08);
      --hero-gray: #f5f7fa;
      --nav-bg: rgba(255, 255, 255, 0.95);
      --hero-bg: linear-gradient(135deg, #F9F6FF 0%, #F0EBFA 100%);
      --premium-gradient: linear-gradient(135deg, #7B5FC4 0%, #5A4496 100%);
      --success-green: #10b981;
      --warning-orange: #f59e0b;
      --danger-red: #ef4444;
      --info-blue: #3b82f6;
      --clarity-green: #059669;
      --clarity-yellow: #d97706;
      --clarity-red: #dc2626;

      /* Canonical category tokens */
      --category-clarity: #7B5FC4;
      --category-burnout: #f59e0b;
      --category-manager: #10b981;
      --category-politics: #3b82f6;
      --category-hr: #6D28D9;
      --category-confidence: #ef4444;
      --category-career: #800020;
    }

    /* Dark Mode Variables */
    .dark-mode {
      --primary-white: #1a1a1a;
      --light-gray: #2a2a2a;
      --medium-gray: #3a3a3a;
      --dark-gray: #888888;
      --text-dark: #e0e0e0;
      --text-medium: #b0b0b0;
      --accent-purple: #9d86e9;
      --accent-purple-dark: #7b5fc4;
      --light-purple: rgba(123, 95, 196, 0.2);
      --lighter-purple: rgba(123, 95, 196, 0.1);
      --border-light: rgba(255, 255, 255, 0.08);
      --hero-gray: #2a2a2a;
      --nav-bg: rgba(30, 30, 30, 0.95);
      --hero-bg: linear-gradient(135deg, #2a2a2a 0%, #1f1f1f 100%);
      --premium-gradient: linear-gradient(135deg, #9d86e9 0%, #7b5fc4 100%);
      --clarity-green: #10b981;
      --clarity-yellow: #f59e0b;
      --clarity-red: #ef4444;
    }

    /* ===========================
       GLOBAL STYLES
    =========================== */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    }

    html { scroll-behavior: smooth; }

    body {
      background-color: var(--primary-white);
      color: var(--text-dark);
      line-height: 1.6;
      overflow-x: hidden;
      opacity: 0;
      transition: opacity 0.4s ease, background-color 0.3s ease, color 0.3s ease;
      min-height: 100vh;
    }

    html.preload-dark body { background-color: #1a1a1a; color: #e0e0e0; }
    body.loaded { opacity: 1; }

    .container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 0 20px;
    }

    /* ===========================
       NAVIGATION (POST-LOGIN HEADER)
    =========================== */
    nav {
      position: fixed;
      top: 0;
      width: 100%;
      background: var(--nav-bg);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      z-index: 1000;
      border-bottom: 1px solid var(--border-light);
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
      transition: background-color 0.3s ease, border-color 0.3s ease;
      height: 80px;
    }

    .nav-container {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px 0;
      height: 100%;
    }

    .logo { display: block; text-decoration: none; }

    .logo-img {
      height: 100px;
      width: auto;
      transform: translateX(20%);
      padding: 14px 10px;
      transition: all 0.3s ease;
      display: block;
      min-height: 100px;
    }

    .logo-fallback {
      display: none;
      font-size: 24px;
      font-weight: 700;
      color: var(--text-dark);
      text-decoration: none;
    }

    .nav-links {
      display: flex;
      gap: 50px;
      transform: translateX(-28px);
    }

    .nav-link {
      color: var(--text-dark);
      text-decoration: none;
      font-weight: 500;
      transition: color 0.3s ease;
      font-size: 17px;
      position: relative;
    }

    .nav-link:hover { color: var(--accent-purple); }

    .nav-link.active { color: var(--text-dark); }
    .nav-link.active::after {
      content: '';
      position: absolute;
      bottom: -7px;
      left: 0;
      width: 100%;
      height: 2px;
      background: var(--accent-purple);
      border-radius: 2px 2px 0 0;
    }

    .nav-link-container { position: relative; display: inline-block; }

    .new-tag {
      position: absolute;
      top: -12px;
      right: -35px;
      background: linear-gradient(135deg, #FFD700, #FFA500);
      color: #000;
      font-size: 10px;
      font-weight: 700;
      padding: 2px 6px;
      border-radius: 4px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.2);
      z-index: 10;
      white-space: nowrap;
    }

    .dark-mode .new-tag { box-shadow: 0 2px 4px rgba(0,0,0,0.4); }

    .nav-actions {
      display: flex;
      align-items: center;
      gap: 14px;
      transform: translateX(calc(-30% - 15px));
    }

    .user-initials {
      width: 38px;
      height: 38px;
      border-radius: 999px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      text-decoration: none;
      font-weight: 700;
      font-size: 13px;
      letter-spacing: 0.5px;
      color: var(--text-dark);
      background: var(--primary-white);
      border: 1px solid var(--border-light);
      transition: all 0.25s ease;
      user-select: none;
      flex: 0 0 auto;
    }

    .user-initials:hover {
      transform: translateY(-1px);
      border-color: rgba(123, 95, 196, 0.35);
      box-shadow: 0 8px 18px rgba(123, 95, 196, 0.12);
      color: var(--accent-purple);
    }

    .dark-mode .user-initials {
      background: rgba(255,255,255,0.06);
      border-color: rgba(255,255,255,0.12);
      color: var(--text-dark);
    }

    .dark-mode .user-initials:hover {
      border-color: rgba(139,108,230,0.35);
      box-shadow: 0 10px 22px rgba(139,108,230,0.14);
      color: var(--accent-purple);
    }

    .logout-link {
      display: none;
      font-size: 13px;
      font-weight: 700;
      color: var(--text-medium);
      text-decoration: none;
      padding: 7px 10px;
      border-radius: 999px;
      border: 1px solid var(--border-light);
      background: rgba(255,255,255,0.7);
      transition: all .2s ease;
      cursor: pointer;
      user-select: none;
    }
    .logout-link:hover {
      transform: translateY(-1px);
      border-color: rgba(123, 95, 196, 0.35);
      color: var(--accent-purple-dark);
      box-shadow: 0 8px 18px rgba(123, 95, 196, 0.10);
    }
    .dark-mode .logout-link {
      background: rgba(255,255,255,0.06);
      border-color: rgba(255,255,255,0.12);
      color: var(--text-medium);
    }

    .theme-toggle {
      background: none;
      border: none;
      color: var(--text-dark);
      cursor: pointer;
      font-size: 16px;
      width: 36px;
      height: 36px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background-color 0.3s ease;
    }
    .theme-toggle:hover { background-color: var(--light-gray); }

    .mobile-toggle {
      display: none;
      background: none;
      border: none;
      color: var(--text-dark);
      cursor: pointer;
      font-size: 24px;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      align-items: center;
      justify-content: center;
      transition: background-color 0.3s ease;
    }
    .mobile-toggle:hover { background-color: var(--light-gray); }

    .mobile-profile {
      display: none;
      margin-top: 10px;
      padding: 12px 20px;
      background: var(--accent-purple);
      color: white;
      border-radius: 8px;
      text-align: center;
      font-weight: 600;
      text-decoration: none;
    }

    .mobile-cta-tab {
      display: none;
      position: fixed;
      top: 50%;
      right: 0;
      transform: translateY(-50%) rotate(-90deg);
      transform-origin: right bottom;
      background: var(--accent-purple);
      color: white;
      padding: 12px 20px;
      border-radius: 8px 8px 0 0;
      text-decoration: none;
      font-weight: 600;
      font-size: 14px;
      box-shadow: 0 5px 15px rgba(123, 95, 196, 0.4);
      z-index: 998;
      transition: all 0.3s ease;
      white-space: nowrap;
    }
    .mobile-cta-tab:hover { background: var(--accent-purple-dark); }

    @media (max-width: 992px) {
      .nav-links { gap: 30px; }
      .nav-actions { gap: 12px; }
    }

    @media (max-width: 768px) {
      .nav-container { justify-content: center; position: relative; }

      .logo {
        position: absolute;
        left: 50%;
        transform: translateX(-50%);
        display: flex;
        align-items: center;
        height: 100%;
      }

      .logo-img {
        height: 125px;
        transform: none;
        padding: 12px 0;
      }

      .mobile-toggle {
        display: flex;
        position: absolute;
        left: 20px;
        align-items: center;
      }

      .nav-actions {
        transform: none;
        gap: 12px;
        position: absolute;
        right: 20px;
        align-items: center;
      }

      .nav-actions .user-initials { display: none; }
      .nav-actions .logout-link { display: none !important; }

      .nav-links {
        display: none;
        position: absolute;
        top: 100%;
        left: 0;
        width: 100%;
        background: var(--nav-bg);
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        flex-direction: column;
        padding: 20px;
        border-top: 1px solid var(--border-light);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        gap: 20px;
        transform: none;
      }

      .nav-links.active { display: flex; }
      .nav-link-container { display: flex; width: 100%; }
      .new-tag { position: static; margin-left: 8px; }

      .mobile-profile { display: block !important; }
      .mobile-cta-tab { display: block; }
    }

    /* ===========================
       HERO SECTION
    =========================== */
    .tool-hero-section {
      width: 100%;
      background: var(--hero-bg);
      padding: 20px 0 30px;
      margin-top: 110px;
      position: relative;
      border-bottom: 1px solid var(--border-light);
      overflow: hidden;
    }

    .tool-hero-section::before {
      content: '';
      position: absolute;
      top: 0; left: 0; right: 0; height: 100%;
      background: linear-gradient(135deg, rgba(250, 245, 255, 0.85) 0%, rgba(245, 240, 255, 0.6) 50%, rgba(255, 255, 255, 0.25) 100%);
      z-index: 1;
    }

    .dark-mode .tool-hero-section::before {
      background: linear-gradient(135deg, rgba(42, 42, 42, 0.9) 0%, rgba(31, 31, 31, 0.7) 50%, rgba(26, 26, 26, 0.4) 100%);
    }

    .tool-hero-content {
      position: relative;
      z-index: 2;
      max-width: 1100px;
      margin: 0 auto;
      padding: 0 20px 10px;
      animation: heroFadeUp 0.45s ease-out;
    }

    @keyframes heroFadeUp {
      from { opacity: 0; transform: translateY(18px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .breadcrumb {
      font-size: 10px;
      text-transform: uppercase;
      letter-spacing: 1px;
      color: var(--dark-gray);
      margin-bottom: 10px;
      display: flex;
      gap: 6px;
      align-items: center;
      flex-wrap: wrap;
    }

    .breadcrumb a {
      color: var(--text-medium);
      text-decoration: none !important;
      font-weight: 500;
      letter-spacing: 0.5px;
      transition: color 0.2s ease;
    }

    .breadcrumb a:hover { color: var(--accent-purple-dark); }
    .breadcrumb i { color: var(--dark-gray); opacity: 0.8; }
    .breadcrumb .current { color: var(--text-dark); font-weight: 600; }

    .save-btn {
      position: absolute;
      top: 16px;
      right: 24px;
      z-index: 5;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 12px;
      font-size: 12px;
      font-weight: 600;
      border-radius: 999px;
      border: 1px solid rgba(123, 95, 196, 0.6);
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
      color: var(--accent-purple-dark);
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .save-btn i { font-size: 13px; }

    .save-btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 10px rgba(123, 95, 196, 0.18);
      background: #ffffff;
    }

    .dark-mode .save-btn {
      background: rgba(20, 20, 20, 0.9);
      border-color: rgba(157, 134, 233, 0.6);
      color: var(--accent-purple);
    }

    .save-btn.saved {
      background: var(--accent-purple);
      color: #ffffff;
      border-color: transparent;
    }

    .checklist-name {
      font-size: 20px;
      font-weight: 600;
      color: var(--accent-purple);
      text-transform: uppercase;
      letter-spacing: 1.8px;
      margin-bottom: 14px;
      margin-top: 32px;
      display: block;
    }

    .hero-main-heading {
      font-size: 46px;
      font-weight: 600;
      color: var(--text-dark);
      line-height: 1.1;
      margin-bottom: 20px;
      max-width: 1100px;
    }

    .hero-subheading {
      font-size: 16px;
      color: var(--text-medium);
      line-height: 1.6;
      max-width: 980px;
      margin-bottom: 30px;
    }

    /* ===========================
       CATEGORY PILLS (Canonical colours)
    =========================== */
    .category-pills-container { margin-bottom: 30px; }

    .category-pills-title {
      font-size: 12px;
      font-weight: 600;
      color: var(--text-medium);
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-bottom: 14px;
      display: block;
    }

    .category-pills-grid {
      display: flex;
      gap: 10px;
      margin-bottom: 10px;
      flex-wrap: wrap;
    }

    .category-pill {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      border: 1px solid transparent;
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      text-decoration: none;
      height: 32px;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
      transition: all 0.2s ease;
      cursor: pointer;
      white-space: nowrap;
    }

    .dark-mode .category-pill {
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
    }

    .category-pill:hover {
      transform: translateY(-1px);
      box-shadow: 0 3px 8px rgba(0, 0, 0, 0.08);
      text-decoration: none;
    }

    .dark-mode .category-pill:hover { box-shadow: 0 3px 8px rgba(0, 0, 0, 0.35); }

    .category-pill.clarity {
      color: #7B5FC4;
      border-color: rgba(123, 95, 196, 0.20);
      background: linear-gradient(135deg, rgba(123, 95, 196, 0.08), rgba(123, 95, 196, 0.04));
    }

    .dark-mode .category-pill.clarity {
      color: #9d86e9;
      border-color: rgba(157, 134, 233, 0.30);
      background: linear-gradient(135deg, rgba(123, 95, 196, 0.18), rgba(123, 95, 196, 0.10));
    }

    .category-pill.priorities {
      color: #10b981;
      border-color: rgba(16, 185, 129, 0.2);
      background: linear-gradient(135deg, rgba(16, 185, 129, 0.08), rgba(16, 185, 129, 0.04));
    }

    .dark-mode .category-pill.priorities {
      color: #34d399;
      border-color: rgba(52, 211, 153, 0.3);
      background: linear-gradient(135deg, rgba(16, 185, 129, 0.18), rgba(16, 185, 129, 0.1));
    }

    .category-pill.confidence {
      color: #ef4444;
      border-color: rgba(239, 68, 68, 0.2);
      background: linear-gradient(135deg, rgba(239, 68, 68, 0.08), rgba(239, 68, 68, 0.04));
    }

    .dark-mode .category-pill.confidence {
      color: #f87171;
      border-color: rgba(248, 113, 113, 0.3);
      background: linear-gradient(135deg, rgba(239, 68, 68, 0.18), rgba(239, 68, 68, 0.1));
    }

    .category-icon { font-size: 11px; opacity: 0.85; flex-shrink: 0; }

    /* ===========================
       CONTEXT & PRO TIPS SECTION
    =========================== */
    .context-tips-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 32px;
      margin-bottom: 40px;
      width: 100%;
      max-width: 1100px;
      margin: 0 auto 50px;
      padding: 24px 20px 10px;
      margin-top: 6px;
    }

    .context-card, .tips-card {
      background: var(--primary-white);
      border: 1px solid var(--border-light);
      border-radius: 12px;
      padding: 28px 30px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.06);
    }

    .dark-mode .context-card,
    .dark-mode .tips-card { box-shadow: 0 2px 8px rgba(0,0,0,0.22); }

    .section-title {
      font-size: 20px;
      font-weight: 600;
      color: var(--text-dark);
      margin-bottom: 18px;
      display: flex;
      align-items: center;
      gap: 10px;
      white-space: nowrap;
    }

    .section-title i { color: var(--accent-purple); }

    .bullet-list { list-style: none; margin: 0; padding: 0; }

    .bullet-list li {
      color: var(--text-medium);
      line-height: 1.6;
      margin-bottom: 14px;
      padding-left: 26px;
      position: relative;
    }

    .bullet-list li::before {
      content: "•";
      position: absolute;
      left: 10px;
      color: var(--accent-purple);
      font-size: 18px;
    }

    /* ===========================
       CHECKLIST BODY
    =========================== */
    .checklist-body {
      max-width: 1100px;
      margin: 0 auto;
      padding: 0 20px 20px;
    }

    .checklist-section-title {
      font-size: 28px;
      font-weight: 700;
      color: var(--accent-purple-dark);
      margin-bottom: 18px;
      margin-top: 60px !important;
    }

    .checklist-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
      margin-bottom: 20px;
    }

    .checklist-item {
      background: var(--primary-white);
      padding: 14px 16px;
      border-radius: 10px;
      box-shadow: 0 1px 4px rgba(0,0,0,0.04);
      border: 1px solid var(--border-light);
      display: flex;
      gap: 12px;
      align-items: flex-start;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
      cursor: pointer;
      height: 100%;
      min-height: 70px;
      outline: none;
    }

    .checklist-item:focus-visible {
      box-shadow: 0 0 0 3px rgba(123, 95, 196, 0.25), 0 1px 4px rgba(0,0,0,0.06);
      border-color: rgba(123, 95, 196, 0.35);
    }

    .dark-mode .checklist-item { box-shadow: 0 1px 4px rgba(0,0,0,0.14); }

    .checklist-item:hover {
      transform: translateY(-2px);
      box-shadow: 0 3px 8px rgba(0,0,0,0.1);
    }

    .dark-mode .checklist-item:hover { box-shadow: 0 3px 8px rgba(0,0,0,0.28); }

    .checklist-item i {
      color: var(--accent-purple);
      font-size: 18px;
      margin-top: 3px;
      flex-shrink: 0;
    }

    .checklist-text {
      flex: 1;
      color: var(--text-medium);
      font-size: 15px;
      line-height: 1.5;
    }

    /* ===========================
       CLARITY METER SECTION
    =========================== */
    .clarity-meter-section {
      max-width: 1100px;
      margin: 25px auto 40px;
      padding: 0 20px;
    }

    .clarity-header { margin-bottom: 18px; text-align: left; }

    .clarity-header h2 {
      font-size: 22px;
      font-weight: 700;
      color: var(--accent-purple-dark);
      margin-bottom: 6px;
    }

    .clarity-header p {
      font-size: 14px;
      color: var(--text-medium);
      max-width: 1100px;
      line-height: 1.5;
    }

    .clarity-meter-container {
      display: flex;
      align-items: stretch;
      gap: 30px;
      background: var(--primary-white);
      border-radius: 16px;
      padding: 22px 24px 20px;
      box-shadow: 0 8px 30px rgba(123, 95, 196, 0.12);
      border: 1px solid rgba(123, 95, 196, 0.15);
    }

    .dark-mode .clarity-meter-container {
      box-shadow: 0 8px 30px rgba(123, 95, 196, 0.25);
      border: 1px solid rgba(123, 95, 196, 0.35);
    }

    .clarity-progress-container { flex: 1.4; }

    .clarity-title-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
      gap: 10px;
    }

    .clarity-title {
      font-size: 20px;
      font-weight: 700;
      color: var(--accent-purple-dark);
    }

    .clarity-status {
      font-size: 15px;
      font-weight: 500;
      padding: 4px 12px;
      border-radius: 20px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      white-space: nowrap;
    }

    .status-green {
      background-color: rgba(16, 185, 129, 0.1);
      color: var(--clarity-green);
      border: 1px solid rgba(16, 185, 129, 0.2);
    }

    .status-yellow {
      background-color: rgba(245, 158, 11, 0.1);
      color: var(--clarity-yellow);
      border: 1px solid rgba(245, 158, 11, 0.2);
    }

    .status-red {
      background-color: rgba(239, 68, 68, 0.1);
      color: var(--clarity-red);
      border: 1px solid rgba(239, 68, 68, 0.2);
    }

    .clarity-meter {
      height: 10px;
      background: var(--light-gray);
      border-radius: 5px;
      overflow: hidden;
      margin-bottom: 6px;
      position: relative;
    }

    .dark-mode .clarity-meter { background: rgba(255, 255, 255, 0.12); }

    .meter-fill {
      height: 100%;
      width: 0%;
      border-radius: 5px;
      transition: width 0.8s cubic-bezier(0.34, 1.56, 0.64, 1);
    }

    .meter-green { background: linear-gradient(135deg, #10b981 0%, #059669 100%); }
    .meter-yellow { background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); }
    .meter-red { background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); }

    .meter-labels {
      display: flex;
      justify-content: space-between;
      font-size: 12px;
      color: var(--dark-gray);
      gap: 10px;
    }

    .clarity-dimensions {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 10px;
      margin-top: 14px;
    }

    .clarity-dimension-pill {
      border-radius: 10px;
      padding: 8px 10px;
      border: 1px solid var(--border-light);
      background: var(--light-gray);
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 13px;
      color: var(--text-medium);
    }

    .dark-mode .clarity-dimension-pill {
      background: rgba(255,255,255,0.04);
      border-color: rgba(255,255,255,0.1);
    }

    .clarity-dimension-pill span.label { font-weight: 600; color: var(--text-dark); }
    .clarity-dimension-pill span.score { font-weight: 700; color: var(--accent-purple); }

    .actions-container {
      display: flex;
      gap: 12px;
      flex-shrink: 0;
      flex-direction: column;
      justify-content: center;
      align-items: stretch;
      max-width: 280px;
    }

    .action-btn {
      background: var(--premium-gradient);
      color: white;
      border: none;
      padding: 10px 18px;
      font-size: 13.5px;
      border-radius: 8px;
      font-weight: 700;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 8px;
      transition: all 0.3s ease;
      width: 100%;
      justify-content: center;
    }

    .action-btn i { font-size: 14px; }

    .action-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(123, 95, 196, 0.3);
    }

    .dark-mode .action-btn:hover { box-shadow: 0 8px 20px rgba(123, 95, 196, 0.4); }

    .action-btn.secondary {
      background: var(--light-purple);
      color: var(--accent-purple-dark);
      border: 1px solid rgba(123, 95, 196, 0.2);
    }

    .dark-mode .action-btn.secondary {
      background: rgba(123, 95, 196, 0.21);
      color: var(--accent-purple);
      border-color: rgba(157, 134, 233, 0.22);
    }

    .action-btn.secondary:hover { background: var(--accent-purple); color: white; }

    .action-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none !important;
      box-shadow: none !important;
    }

    .save-progress-status {
      font-size: 12px;
      color: var(--dark-gray);
      text-align: center;
      margin-top: -6px;
      min-height: 18px;
      user-select: none;
    }

    /* ===========================
       EVIDENCE SECTION
    =========================== */
    .evidence-section {
      max-width: 1100px;
      margin: 0 auto 60px;
      padding: 0 20px;
      display: none;
    }

    .evidence-section.active {
      display: block;
      animation: slideIn 0.5s ease;
    }

    @keyframes slideIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .evidence-header { text-align: center; margin-bottom: 28px; }

    .evidence-title {
      font-size: 24px;
      font-weight: 800;
      color: var(--accent-purple-dark);
      margin-bottom: 6px;
    }

    .evidence-subtitle { color: var(--text-medium); font-size: 16px; margin-bottom: 8px; }

    .evidence-insight {
      font-size: 14px;
      color: var(--dark-gray);
      max-width: 680px;
      margin: 0 auto;
    }

    .section-header {
      font-size: 20px;
      font-weight: 800;
      margin-bottom: 22px;
      display: flex;
      align-items: center;
      gap: 10px;
      padding-bottom: 10px;
      border-bottom: 2px solid var(--light-gray);
    }

    .section-header.red { color: var(--danger-red); }
    .section-header.purple { color: var(--accent-purple-dark); }
    .section-header.blue { color: var(--accent-purple); }

    .red-flags-grid,
    .next-steps-grid,
    .resources-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 20px;
      margin-bottom: 40px;
    }

    .red-flag-card,
    .next-step-card,
    .resource-card {
      background: var(--primary-white);
      border-radius: 12px;
      padding: 20px;
      position: relative;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      height: 100%;
    }

    .red-flag-card { box-shadow: 0 4px 12px rgba(239, 68, 68, 0.08); border: 1px solid rgba(239, 68, 68, 0.1); }
    .next-step-card { box-shadow: 0 4px 12px rgba(123, 95, 196, 0.08); border: 1px solid rgba(123, 95, 196, 0.1); }
    .resource-card { box-shadow: 0 4px 12px rgba(123, 95, 196, 0.08); border: 1px solid rgba(123, 95, 196, 0.1); transition: all 0.2s ease; }

    .dark-mode .red-flag-card { box-shadow: 0 4px 12px rgba(239, 68, 68, 0.18); border: 1px solid rgba(239, 68, 68, 0.22); }
    .dark-mode .next-step-card { box-shadow: 0 4px 12px rgba(123, 95, 196, 0.21); border: 1px solid rgba(123, 95, 196, 0.25); }
    .dark-mode .resource-card { box-shadow: 0 4px 12px rgba(123, 95, 196, 0.21); border: 1px solid rgba(123, 95, 196, 0.25); }

    .resource-card:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 20px rgba(123, 95, 196, 0.16);
    }
    .dark-mode .resource-card:hover { box-shadow: 0 8px 20px rgba(123, 95, 196, 0.25); }

    .red-flag-card::before,
    .next-step-card::before,
    .resource-card::before {
      content: '';
      position: absolute;
      top: 0; left: 0; right: 0;
      height: 3px;
    }

    .red-flag-card::before { background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); }
    .next-step-card::before,
    .resource-card::before { background: linear-gradient(135deg, #7B5FC4 0%, #5A4496 100%); }

    .flag-icon, .step-icon, .resource-icon {
      font-size: 20px;
      margin-bottom: 15px;
      width: 40px;
      height: 40px;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .flag-icon { color: #ef4444; background: rgba(239, 68, 68, 0.1); }
    .step-icon, .resource-icon { color: var(--accent-purple); background: var(--lighter-purple); }

    .dark-mode .flag-icon { background: rgba(239, 68, 68, 0.2); }
    .dark-mode .step-icon, .dark-mode .resource-icon { background: rgba(123, 95, 196, 0.21); }

    .flag-title, .step-title, .resource-title {
      font-size: 16px;
      font-weight: 700;
      color: var(--text-dark);
      margin-bottom: 10px;
    }

    .flag-description, .step-description, .resource-description {
      color: var(--text-medium);
      font-size: 14px;
      line-height: 1.5;
      flex-grow: 1;
    }

    .resource-description { margin-bottom: 15px; }

    .resource-link {
      color: var(--accent-purple);
      font-weight: 700;
      text-decoration: none;
      font-size: 14px;
      display: flex;
      align-items: center;
      gap: 6px;
      margin-top: auto;
    }

    .resource-link:hover { text-decoration: underline; }

    /* ===========================
       MY PLAYBOOK FAB + SIDEBAR
    =========================== */
    .my-playbook-fab {
      position: fixed;
      bottom: 24px;
      right: 24px;
      z-index: 1200;
      background: var(--premium-gradient);
      color: #ffffff;
      padding: 10px 16px;
      border-radius: 999px;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      cursor: pointer;
      font-size: 13px;
      font-weight: 700;
      box-shadow: 0 10px 25px rgba(0,0,0,0.25);
      transition: all 0.25s ease;
    }

    .my-playbook-fab i { font-size: 15px; }

    .my-playbook-fab:hover {
      transform: translateY(-3px);
      box-shadow: 0 14px 30px rgba(0,0,0,0.32);
    }

    .playbook-sidebar-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.45);
      z-index: 1190;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.25s ease;
    }

    .playbook-sidebar-overlay.open {
      opacity: 1;
      pointer-events: auto;
    }

    .playbook-sidebar {
      position: fixed;
      top: 0;
      right: -380px;
      width: 340px;
      max-width: 90%;
      height: 100%;
      background: rgba(255, 255, 255, 0.94);
      backdrop-filter: blur(18px);
      -webkit-backdrop-filter: blur(18px);
      box-shadow: -4px 0 20px rgba(0,0,0,0.25);
      z-index: 1191;
      display: flex;
      flex-direction: column;
      border-left: 1px solid var(--border-light);
      transition: right 0.25s ease;
    }

    .dark-mode .playbook-sidebar {
      background: rgba(18, 18, 18, 0.96);
      box-shadow: -4px 0 22px rgba(0,0,0,0.6);
    }

    .playbook-sidebar.open { right: 0; }

    .playbook-sidebar-header {
      padding: 20px 20px 14px;
      border-bottom: 1px solid var(--border-light);
    }

    .playbook-sidebar-header-title-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 4px;
    }

    .playbook-sidebar-header h3 {
      font-size: 18px;
      font-weight: 700;
      color: var(--text-dark);
    }

    .playbook-sidebar-header p {
      font-size: 13px;
      color: var(--dark-gray);
      font-weight: 400;
    }

    .playbook-close-btn {
      background: none;
      border: none;
      color: var(--dark-gray);
      cursor: pointer;
      font-size: 18px;
      border-radius: 999px;
      width: 28px;
      height: 28px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background-color 0.2s ease;
    }

    .playbook-close-btn:hover { background: var(--light-gray); }

    .playbook-sidebar-body {
      padding: 14px 18px 20px;
      padding-bottom: 50px;
      overflow-y: auto;
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 18px;
    }

    .saved-items-empty {
      font-size: 13px;
      color: var(--dark-gray);
      line-height: 1.6;
      font-weight: 400;
    }

    .saved-items-list { list-style: none; margin: 0; padding: 0; }

    .saved-item {
      padding: 10px 8px 10px;
      border-radius: 10px;
      border: 1px solid var(--border-light);
      background: var(--primary-white);
      box-shadow: 0 1px 4px rgba(0,0,0,0.04);
      margin-bottom: 10px;
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .saved-item-title-row {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      gap: 6px;
    }

    .saved-item-title {
      font-size: 14px;
      font-weight: 600;
      color: var(--text-dark);
    }

    .saved-item-type {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.6px;
      color: var(--accent-purple-dark);
      font-weight: 700;
    }

    .saved-item-meta {
      font-size: 12px;
      color: var(--dark-gray);
      font-weight: 400;
    }

    .saved-item-link {
      margin-top: 6px;
      font-size: 12px;
      color: var(--accent-purple);
      text-decoration: none;
      font-weight: 700;
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .saved-item-link:hover { text-decoration: underline; }

    .playbook-quick-links {
      margin-top: 223px;
      padding-top: 10px;
      border-top: 1px solid var(--border-light);
    }

    .quick-links-title {
      font-size: 12px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.8px;
      color: var(--text-medium);
    }

    .playbook-quick-links-list {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-top: 6px;
    }

    .quick-link-pill {
      width: 50%;
      padding: 4px 4px;
      border-radius: 999px;
      border: 1px solid rgba(123, 95, 196, 0.35);
      background: linear-gradient(135deg,rgba(123, 95, 196, 0.08),rgba(123, 95, 196, 0.02));
      text-decoration: none;
      color: var(--accent-purple-dark);
      font-size: 13px;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .quick-link-pill:hover {
      transform: translateY(-1px);
      box-shadow: 0 3px 8px rgba(0,0,0,0.12);
      background: linear-gradient(135deg,rgba(123, 95, 196, 0.16), rgba(123, 95, 196, 0.06));
    }

    .quick-link-pill i { font-size: 14px; }

    .dark-mode .quick-link-pill {
      border-color: rgba(157, 134, 233, 0.55);
      background: linear-gradient(135deg,rgba(123, 95, 196, 0.26),rgba(123, 95, 196, 0.12));
    }

    /* ===========================
       FOOTER
    =========================== */
    footer {
      background: var(--primary-white);
      padding: 10px 0;
      border-top: 1px solid var(--border-light);
      margin-top: 30px;
      text-align: center;
      color: var(--text-medium);
    }

    /* ===========================
       AUTH LOCK (tool gated behind sign-in)
    =========================== */
    .auth-lock-overlay {
      position: fixed;
      inset: 0;
      z-index: 1300;
      display: none;
      align-items: center;
      justify-content: center;
      padding: 24px;
      background: rgba(0,0,0,0.55);
      backdrop-filter: blur(3px);
      -webkit-backdrop-filter: blur(3px);
    }

    .auth-lock-overlay.active { display: flex; }

    .auth-lock-card {
      width: min(560px, 100%);
      background: var(--primary-white);
      border: 1px solid var(--border-light);
      border-radius: 16px;
      padding: 22px 22px 18px;
      box-shadow: 0 18px 60px rgba(0,0,0,0.35);
    }

    .dark-mode .auth-lock-card {
      background: rgba(18,18,18,0.96);
      border-color: rgba(255,255,255,0.10);
    }

    .auth-lock-title {
      font-size: 18px;
      font-weight: 900;
      color: var(--text-dark);
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .auth-lock-title i { color: var(--accent-purple); }

    .auth-lock-text {
      font-size: 14px;
      color: var(--text-medium);
      line-height: 1.6;
      margin-bottom: 14px;
    }

    .auth-lock-actions {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    .auth-lock-btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      border: none;
      cursor: pointer;
      border-radius: 10px;
      padding: 10px 14px;
      font-weight: 800;
      font-size: 13px;
      text-decoration: none;
      white-space: nowrap;
    }

    .auth-lock-btn.primary { background: var(--premium-gradient); color: #fff; }
    .auth-lock-btn.secondary { background: var(--light-purple); color: var(--accent-purple-dark); }

    .dark-mode .auth-lock-btn.secondary {
      background: rgba(123, 95, 196, 0.21);
      color: var(--accent-purple);
    }

    body.auth-locked .tool-hero-section,
    body.auth-locked .context-tips-grid,
    body.auth-locked .checklist-body,
    body.auth-locked .clarity-meter-section,
    body.auth-locked #evidenceSummary,
    body.auth-locked footer,
    body.auth-locked .my-playbook-fab {
      filter: none;
      opacity: 1;
      user-select: none;
    }

    /* ===========================
       PRINT CSS (Phase 1 Clean PDF)
    =========================== */
    @media print {
      nav,
      .my-playbook-fab,
      .playbook-sidebar-overlay,
      .mobile-cta-tab,
      .save-btn,
      .actions-container,
      .auth-lock-overlay {
        display: none !important;
      }

      body {
        background: #fff !important;
        color: #000 !important;
        opacity: 1 !important;
      }

      .tool-hero-section {
        margin-top: 0 !important;
        padding-top: 0 !important;
      }

      .tool-hero-section::before { display: none !important; }
      .checklist-item { box-shadow: none !important; }
      footer { border-top: 1px solid #ddd !important; }

      .evidence-section.active { display: block !important; }
    }

    /* Responsive adjustments */
    @media (max-width: 1024px) {
      .context-tips-grid { grid-template-columns: 1fr; gap: 24px; }
      .red-flags-grid, .next-steps-grid, .resources-grid { grid-template-columns: repeat(2, 1fr); }
      .checklist-grid { grid-template-columns: 1fr; }
      .checklist-section-title { margin-top: 50px !important; }
      .clarity-meter-container { flex-direction: column; }
      .actions-container { max-width: 100%; flex-direction: row; flex-wrap: wrap; }
    }

    @media (max-width: 768px) {
      .tool-hero-section { margin-top: 100px; }
      .context-tips-grid { padding: 20px 20px 10px; margin-top: 5px; }
      .context-card, .tips-card { padding: 24px; }
      .section-title { font-size: 18px; white-space: normal; }
      .hero-main-heading { font-size: 36px; }
      .hero-subheading { font-size: 16px; max-width: 100%; }
      .clarity-meter-container { padding: 18px 18px 18px; }
      .actions-container { flex-direction: column; align-items: stretch; }
      .red-flags-grid, .next-steps-grid, .resources-grid { grid-template-columns: 1fr; }
      .category-pills-grid { justify-content: flex-start; }
      .checklist-section-title { margin-top: 40px !important; }
      .save-btn { right: 18px; top: 10px; }
      .my-playbook-fab { bottom: 18px; right: 18px; }
    }

    @media (max-width: 480px) {
      .hero-main-heading { font-size: 32px; }
      .checklist-name { font-size: 18px; }
      .evidence-title { font-size: 22px; }
      .section-header { font-size: 18px; }
      .clarity-status { font-size: 14px; }
      .category-pill { font-size: 11px; padding: 5px 10px; height: 30px; }
      .checklist-item { padding: 12px 14px; min-height: 65px; }
      .checklist-text { font-size: 14px; }
      .checklist-section-title { margin-top: 30px !important; }
      .clarity-dimensions { grid-template-columns: 1fr; }
    }
  </style>
</head>

<body>

  <a href="#" class="mobile-cta-tab" id="mobileMyPlaybookTab">My Playbook</a>

  <!-- ===========================
       NAVIGATION (POST-LOGIN)
  =========================== -->
  <nav>
    <div class="container nav-container">
      <button class="mobile-toggle" id="mobileToggle" aria-label="Open menu" aria-expanded="false" aria-controls="navLinks">
        <i class="fas fa-bars"></i>
      </button>

      <a href="index.html" class="logo" aria-label="Home">
        <img src="assets/img/logo.png" alt="The Employee Playbook" class="logo-img" id="mainLogo"
             onerror="this.style.display='none'; document.getElementById('logo-fallback').style.display='block';">
        <div class="logo-fallback" id="logo-fallback">THE EMPLOYEE PLAYBOOK</div>
      </a>

      <div class="nav-links" id="navLinks">
        <a href="the-lens.html" class="nav-link">The Lens</a>
        <a href="the-toolkit.html" class="nav-link active">The Toolkit</a>
        <div class="nav-link-container">
          <a href="the-coach.html" class="nav-link">The Coach</a>
          <span class="new-tag">NEW</span>
        </div>
        <a href="the-shift.html" class="nav-link">The Shift</a>
        <a href="the-pricing.html" class="nav-link">The Pricing</a>

        <a href="profile.html" class="mobile-profile" id="mobileProfileBtn">Profile</a>
      </div>

      <div class="nav-actions">
        <a href="sign-in.html" class="user-initials" id="userInitialsBtn" aria-label="Open profile">…</a>

        <a class="logout-link" id="logoutBtn" href="#" aria-label="Log out">Log out</a>
        <button class="theme-toggle" id="themeToggleBtn" aria-label="Toggle theme">
          <i class="fas fa-moon"></i>
        </button>
      </div>
    </div>
  </nav>

  <main id="toolMain">
    <!-- ===========================
         HERO
    =========================== -->
    <div class="tool-hero-section">
      <button class="save-btn" id="saveBtn" type="button">
        <i class="far fa-bookmark"></i>
        <span>Save item</span>
      </button>

      <div class="tool-hero-content">
        <div class="breadcrumb">
          <a href="the-toolkit.html">Toolkit</a>
          <i class="fas fa-chevron-right"></i>
          <span>Clarity, Priorities & Direction</span>
          <i class="fas fa-chevron-right"></i>
          <span class="current">Workload Clarity Checklist</span>
        </div>

        <span class="checklist-name">WORKLOAD CLARITY CHECKLIST</span>

        <h1 class="hero-main-heading">Get clear on expectations, priorities and hidden risks</h1>

        <div class="hero-subheading">
          When work feels overwhelming, unclear or directionless, use this checklist to rapidly 
          remove ambiguity, reset expectations and protect yourself from misunderstandings.
        </div>

        <div class="category-pills-container">
          <span class="category-pills-title">Category</span>

          <div class="category-pills-grid">
            <a href="category-clarity-priorities-and-direction.html" class="category-pill clarity">
              <i class="fas fa-bullseye category-icon"></i>
              <span>Clarity, Priorities & Direction</span>
            </a>
          </div>
        </div>
      </div>
    </div>

    <!-- ===========================
         CONTEXT & PRO TIPS
    =========================== -->
    <div class="context-tips-grid">
      <div class="context-card">
        <h3 class="section-title"><i class="fas fa-calendar-check"></i>When to Use This Checklist</h3>
        <ul class="bullet-list">
          <li>When work feels overwhelming, unclear or directionless</li>
          <li>When starting a new project or taking on new responsibilities</li>
          <li>When you're unsure about priorities or what success looks like</li>
          <li>When you want to ensure alignment with your manager before diving in</li>
          <li>When you sense there might be hidden expectations or unspoken priorities</li>
        </ul>
      </div>

      <div class="tips-card">
        <h3 class="section-title"><i class="fas fa-lightbulb"></i>Pro Tips</h3>
        <ul class="bullet-list">
          <li>Be honest with yourself - the checklist only helps if you're truthful</li>
          <li>Use it as a conversation starter with your manager or team</li>
          <li>Revisit this checklist whenever priorities shift or work feels unclear</li>
          <li>Don't rush - take time to think through each item carefully</li>
          <li>Share completed checklists with your manager for better alignment</li>
        </ul>
      </div>
    </div>

    <!-- ===========================
         CHECKLIST BODY
    =========================== -->
    <div class="checklist-body" id="checklistText">
      <h2 class="checklist-section-title">Your Checklist</h2>

      <div class="checklist-grid" id="checklistGrid">
        <div class="checklist-item" data-category="priorities">
          <i class="far fa-square"></i>
          <div class="checklist-text">I know my top 3 priorities this week, not just tasks, but what success looks like.</div>
        </div>
        <div class="checklist-item" data-category="quality">
          <i class="far fa-square"></i>
          <div class="checklist-text">I understand what "good" looks like for each key task (quality, detail, format, tone).</div>
        </div>
        <div class="checklist-item" data-category="urgency">
          <i class="far fa-square"></i>
          <div class="checklist-text">I know which tasks are genuinely urgent and which are only "urgent" to others.</div>
        </div>
        <div class="checklist-item" data-category="deadlines">
          <i class="far fa-square"></i>
          <div class="checklist-text">I know the real deadlines, not just the ones in the calendar, but the ones that matter to stakeholders.</div>
        </div>
        <div class="checklist-item" data-category="collaboration">
          <i class="far fa-square"></i>
          <div class="checklist-text">I know who I need to involve, what they own, and what I need from them to progress.</div>
        </div>
        <div class="checklist-item" data-category="expectations">
          <i class="far fa-square"></i>
          <div class="checklist-text">I understand what my manager is expecting from me this week, including any unspoken priorities.</div>
        </div>
        <div class="checklist-item" data-category="flexibility">
          <i class="far fa-square"></i>
          <div class="checklist-text">I've identified tasks I can deprioritise or delay if workload increases unexpectedly.</div>
        </div>
        <div class="checklist-item" data-category="blockers">
          <i class="far fa-square"></i>
          <div class="checklist-text">I know what might block progress, and what I can do early to prevent delays.</div>
        </div>
        <div class="checklist-item" data-category="communication">
          <i class="far fa-square"></i>
          <div class="checklist-text">I know what updates or check-ins my manager wants, and how frequently.</div>
        </div>
        <div class="checklist-item" data-category="resources">
          <i class="far fa-square"></i>
          <div class="checklist-text">I have the resources, access, and information required to complete my work properly.</div>
        </div>
        <div class="checklist-item" data-category="hidden-tasks">
          <i class="far fa-square"></i>
          <div class="checklist-text">I've identified any "hidden tasks", work that's expected but never written down.</div>
        </div>
        <div class="checklist-item" data-category="escalation">
          <i class="far fa-square"></i>
          <div class="checklist-text">I know what to escalate early to avoid surprises later.</div>
        </div>
      </div>
    </div>

    <!-- ===========================
         CLARITY METER SECTION
    =========================== -->
    <div class="clarity-meter-section">
      <div class="clarity-header">
        <h2>Your Workload Clarity Snapshot</h2>
        <p>
          Your Workload Clarity Score is a read on how clearly you understand your priorities, deadlines, and expectations. 
          High scores don't mean "perfect workload"; low or mixed scores don't mean "poor performance". They show you where 
          ambiguity, hidden expectations, or unclear priorities are creating unnecessary stress and risk.
        </p>
      </div>

      <div class="clarity-meter-container">
        <div class="clarity-progress-container">
          <div class="clarity-title-row">
            <div class="clarity-title">Workload Clarity Score</div>
            <div class="clarity-status" id="clarityStatus">Getting Started</div>
          </div>

          <div class="clarity-meter">
            <div class="meter-fill" id="meterFill"></div>
          </div>

          <div class="meter-labels">
            <span>Unclear & At Risk</span>
            <span>Partial Clarity</span>
            <span>Clear & Aligned</span>
          </div>

          <div class="clarity-dimensions">
            <div class="clarity-dimension-pill">
              <span class="label">Priorities & Goals</span>
              <span class="score" id="scorePriorities">0%</span>
            </div>
            <div class="clarity-dimension-pill">
              <span class="label">Deadlines & Timing</span>
              <span class="score" id="scoreDeadlines">0%</span>
            </div>
            <div class="clarity-dimension-pill">
              <span class="label">Resources & Support</span>
              <span class="score" id="scoreResources">0%</span>
            </div>
            <div class="clarity-dimension-pill">
              <span class="label">Expectations & Communication</span>
              <span class="score" id="scoreExpectations">0%</span>
            </div>
          </div>
        </div>

        <div class="actions-container">
          <button class="action-btn" onclick="generateSmartSummary()" id="generateBtn" disabled>
            <i class="fas fa-magic"></i> Generate Summary
          </button>

          <button class="action-btn secondary" onclick="printChecklistPDF()" id="printBtn">
            <i class="fas fa-print"></i> Print / Save PDF
          </button>

          <button class="action-btn secondary" onclick="clearAllChecklist()" id="clearBtn" disabled>
            <i class="fas fa-eraser"></i> Clear All
          </button>

          <button class="action-btn secondary" id="saveProgressBtn" disabled>
            <i class="fas fa-cloud-arrow-up"></i> Save Progress
          </button>
          <div class="save-progress-status" id="saveProgressStatus"></div>
        </div>
      </div>
    </div>

    <!-- ===========================
         EVIDENCE SECTION
    =========================== -->
    <div class="evidence-section" id="evidenceSummary">
      <div class="evidence-header">
        <h2 class="evidence-title">Your Smart Workload Analysis</h2>
        <p class="evidence-subtitle">
          Based on your Workload Clarity Score of <span id="summaryScore">0%</span> • Status: <span id="summaryStatus">Getting Started</span>
        </p>
        <p class="evidence-insight">
          Use this as a signal, not a verdict. It highlights where your understanding is already strong 
          and where small, deliberate conversations will have the highest impact.
        </p>
      </div>

      <h3 class="section-header red">
        <i class="fas fa-exclamation-triangle"></i> Red Flags Identified
      </h3>
      <div class="red-flags-grid" id="redFlagsGrid"></div>

      <h3 class="section-header purple">
        <i class="fas fa-forward"></i> Next Steps
      </h3>
      <div class="next-steps-grid" id="nextStepsGrid"></div>

      <h3 class="section-header blue">
        <i class="fas fa-tools"></i> Recommended Resources
      </h3>
      <div class="resources-grid" id="resourcesGrid"></div>
    </div>

    <!-- ===========================
         MY PLAYBOOK SIDEBAR
    =========================== -->
    <div class="playbook-sidebar-overlay" id="playbookOverlay">
      <div class="playbook-sidebar" id="playbookSidebar">
        <div class="playbook-sidebar-header">
          <div class="playbook-sidebar-header-title-row">
            <h3>My Playbook</h3>
            <button class="playbook-close-btn" id="closePlaybook" aria-label="Close My Playbook" type="button">
              <i class="fas fa-times"></i>
            </button>
          </div>
          <p>Saved items</p>
        </div>

        <div class="playbook-sidebar-body">
          <div id="savedItemsContainer">
            <p class="saved-items-empty" id="savedItemsEmpty">
              You haven't saved anything yet. Use <strong>Save item</strong> on tools you want quick access to.
            </p>
            <ul class="saved-items-list" id="savedItemsList"></ul>
          </div>

          <div class="playbook-quick-links">
            <div class="playbook-quick-links-header">
              <span class="quick-links-title">Quick links</span>
            </div>
            <div class="playbook-quick-links-list">
              <a href="dashboard.html" class="quick-link-pill">
                <i class="fas fa-gauge"></i> The Dashboard
              </a>
              <a href="the-lens.html" class="quick-link-pill">
                <i class="fas fa-search"></i> The Lens
              </a>
              <a href="the-toolkit.html" class="quick-link-pill">
                <i class="fas fa-toolbox"></i> The Toolkit
              </a>
              <a href="the-coach.html" class="quick-link-pill">
                <i class="fas fa-comments"></i> The Coach
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="my-playbook-fab" id="myPlaybookButton" role="button" tabindex="0" aria-label="Open My Playbook">
      <i class="fas fa-book-open"></i>
      <span>My Playbook</span>
    </div>

    <!-- ===========================
         FOOTER
    =========================== -->
    <footer>
      <div class="container">
        <p>© 2025 The Employee Playbook. All rights reserved.</p>
      </div>
    </footer>
  </main>

  <!-- ===========================
       AUTH LOCK OVERLAY
  =========================== -->
  <div class="auth-lock-overlay" id="authLockOverlay" aria-hidden="true">
    <div class="auth-lock-card" role="dialog" aria-modal="true" aria-label="Sign in required">
      <div class="auth-lock-title">
        <i class="fas fa-lock"></i>
        Sign in required
      </div>
      <div class="auth-lock-text">
        This tool is available to signed-in members so your progress can be saved securely.
        Sign in to unlock the checklist and analysis.
      </div>
      <div class="auth-lock-actions">
        <a class="auth-lock-btn primary" href="./sign-in.html">
          <i class="fas fa-right-to-bracket"></i> Sign in
        </a>
        <a class="auth-lock-btn secondary" href="the-pricing.html">
          <i class="fas fa-gem"></i> View plans
        </a>
      </div>
    </div>
  </div>

  <!-- ===========================
       JAVASCRIPT (page logic)
  =========================== -->
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      document.body.classList.add('loaded');

      try {
        const saved = localStorage.getItem('theme');
        const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
        const useDark = saved ? saved === 'dark' : prefersDark;
        if (useDark) document.body.classList.add('dark-mode');
        document.documentElement.classList.remove('preload-dark');
      } catch (e) {}

      initializeChecklist();
      initializeThemeToggle();
      initializeMobileNav();
      initializePlaybook();
      wireHeaderMyPlaybookHooks();
      wireFabKeyboard();
    });

    /* ===========================
       PHASE 1: UNSAVED / LAST SAVED UI
    =========================== */
    window.__tep_unsaved = false;

    function fmtGB(ts) {
      try {
        return new Date(ts).toLocaleString('en-GB', {
          day: '2-digit', month: 'short', year: 'numeric',
          hour: '2-digit', minute: '2-digit'
        });
      } catch (e) {
        return '';
      }
    }

    function setSaveStatus(text, type = "info") {
      const el = document.getElementById("saveProgressStatus");
      if (!el) return;
      el.textContent = text || "";
      el.style.color =
        type === "ok" ? "var(--success-green)" :
        type === "err" ? "var(--danger-red)" :
        "var(--dark-gray)";
    }

    function markUnsaved() {
      window.__tep_unsaved = true;
      const last = localStorage.getItem("tep_last_saved_workload_clarity");
      const suffix = last ? ` • Last saved: ${fmtGB(last)}` : "";
      setSaveStatus("Unsaved changes" + suffix, "info");
    }

    function markSaved(nowIso) {
      window.__tep_unsaved = false;
      const stamp = nowIso || new Date().toISOString();
      localStorage.setItem("tep_last_saved_workload_clarity", stamp);
      setSaveStatus(`Saved • ${fmtGB(stamp)}`, "ok");
    }

    function markLoaded() {
      window.__tep_unsaved = false;
      const last = localStorage.getItem("tep_last_saved_workload_clarity");
      const suffix = last ? ` • Last saved: ${fmtGB(last)}` : "";
      setSaveStatus("Loaded your saved progress" + suffix, "ok");
    }

    function markNeutral() {
      const last = localStorage.getItem("tep_last_saved_workload_clarity");
      if (last) setSaveStatus(`Last saved: ${fmtGB(last)}`, "info");
      else setSaveStatus("", "info");
    }

    /* ===========================
       MOBILE NAV (with aria-expanded)
    =========================== */
    function initializeMobileNav() {
      const mobileToggle = document.querySelector('.mobile-toggle');
      const navLinks = document.querySelector('.nav-links');

      if (mobileToggle && navLinks) {
        mobileToggle.addEventListener('click', function () {
          const isOpen = navLinks.classList.toggle('active');
          this.setAttribute("aria-expanded", isOpen ? "true" : "false");

          const icon = this.querySelector('i');
          if (icon) {
            icon.classList.toggle('fa-bars');
            icon.classList.toggle('fa-times');
          }
        });
      }

      document.addEventListener('click', function(event) {
        if (!navLinks || !mobileToggle) return;
        if (navLinks.classList.contains('active') &&
            !navLinks.contains(event.target) &&
            !mobileToggle.contains(event.target)) {
          navLinks.classList.remove('active');
          mobileToggle.setAttribute("aria-expanded", "false");
          const icon = mobileToggle.querySelector('i');
          if (icon) {
            icon.classList.add('fa-bars');
            icon.classList.remove('fa-times');
          }
        }
      });
    }

    /* ===========================
       THEME TOGGLE (stable)
    =========================== */
    function initializeThemeToggle() {
      const themeToggleBtn = document.getElementById('themeToggleBtn');
      if (!themeToggleBtn) return;

      const themeIcon = themeToggleBtn.querySelector('i');
      const logoImg = document.getElementById('mainLogo');

      function updateIcon(isDark) {
        if (!themeIcon) return;
        themeIcon.classList.toggle('fa-moon', !isDark);
        themeIcon.classList.toggle('fa-sun', isDark);
      }

      function updateLogo(isDark) {
        if (!logoImg) return;
        logoImg.src = isDark ? 'assets/img/logo-dark.png' : 'assets/img/logo.png';
      }

      const saved = localStorage.getItem('theme');
      const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
      const isDarkInitial = saved ? saved === 'dark' : prefersDark;
      updateIcon(isDarkInitial);
      updateLogo(isDarkInitial);

      themeToggleBtn.addEventListener('click', function() {
        const isDarkMode = document.body.classList.toggle('dark-mode');
        localStorage.setItem('theme', isDarkMode ? 'dark' : 'light');
        updateIcon(isDarkMode);
        updateLogo(isDarkMode);
      });

      const mq = window.matchMedia('(prefers-color-scheme: dark)');
      mq.addEventListener('change', (e) => {
        if (localStorage.getItem('theme')) return;
        const shouldDark = e.matches;
        document.body.classList.toggle('dark-mode', shouldDark);
        updateIcon(shouldDark);
        updateLogo(shouldDark);
      });

      if (logoImg) {
        logoImg.addEventListener('error', function() {
          if (this.src.includes('logo-dark.png')) {
            this.src = 'assets/img/logo.png';
          } else {
            this.style.display = 'none';
            const fb = document.getElementById('logo-fallback');
            if (fb) fb.style.display = 'block';
          }
        });
      }
    }

    /* ===========================
       CHECKLIST LOGIC (state on window)
    =========================== */
    window.checkedItems = [];
    window.itemCategories = [];

    const dimensionConfig = {
      priorities: ['priorities', 'quality', 'flexibility'],
      deadlines: ['deadlines', 'urgency'],
      resources: ['resources', 'collaboration', 'blockers'],
      expectations: ['expectations', 'communication', 'hidden-tasks', 'escalation']
    };

    function getCheckedCount() {
      return Array.isArray(window.checkedItems) ? window.checkedItems.filter(Boolean).length : 0;
    }
    window.getCheckedCount = getCheckedCount;

    function initializeChecklist() {
      const checklistContainers = document.querySelectorAll('.checklist-item');
      window.checkedItems = new Array(checklistContainers.length).fill(false);
      window.itemCategories = [];

      checklistContainers.forEach((container, index) => {
        const icon = container.querySelector('i');
        const category = container.getAttribute('data-category');
        window.itemCategories[index] = category;

        container.setAttribute("role", "button");
        container.setAttribute("tabindex", "0");
        container.setAttribute("aria-pressed", "false");

        const toggleItem = () => {
          if (!icon) return;

          if (icon.classList.contains('fa-square')) {
            icon.classList.remove('fa-square');
            icon.classList.add('fa-check-square');
            icon.style.color = '#5A4496';
            window.checkedItems[index] = true;
            container.setAttribute("aria-pressed", "true");
          } else {
            icon.classList.remove('fa-check-square');
            icon.classList.add('fa-square');
            icon.style.color = '#7B5FC4';
            window.checkedItems[index] = false;
            container.setAttribute("aria-pressed", "false");
          }

          updateClarityScore();
          markUnsaved();
        };

        container.addEventListener('click', function(e) {
          if (e.target && e.target.closest && e.target.closest('.actions-container')) return;
          toggleItem();
        });

        container.addEventListener("keydown", (e) => {
          if (e.key === "Enter" || e.key === " ") {
            e.preventDefault();
            toggleItem();
          }
        });
      });

      updateClarityScore();
    }

    function syncActionButtons(isLocked) {
      const generateBtn = document.getElementById('generateBtn');
      const clearBtn = document.getElementById('clearBtn');
      const printBtn = document.getElementById('printBtn');
      const saveProgressBtn = document.getElementById('saveProgressBtn');

      const checkedCount = getCheckedCount();

      if (generateBtn) generateBtn.disabled = !!isLocked || checkedCount === 0;
      if (clearBtn) clearBtn.disabled = !!isLocked || checkedCount === 0;
      if (printBtn) printBtn.disabled = !!isLocked;
      if (saveProgressBtn) {
        if (isLocked) saveProgressBtn.disabled = true;
      }
    }
    window.syncActionButtons = syncActionButtons;

    function updateClarityScore() {
      const checkedCount = getCheckedCount();
      const totalCount = window.checkedItems.length;
      const clarityScore = totalCount > 0 ? Math.round((checkedCount / totalCount) * 100) : 0;

      const meterFill = document.getElementById('meterFill');
      const clarityStatus = document.getElementById('clarityStatus');

      if (meterFill) meterFill.style.width = clarityScore + '%';

      if (meterFill) meterFill.classList.remove('meter-green', 'meter-yellow', 'meter-red');
      if (clarityStatus) clarityStatus.classList.remove('status-green', 'status-yellow', 'status-red');

      let statusText = 'Getting Started';
      if (clarityScore >= 75) {
        if (meterFill) meterFill.classList.add('meter-green');
        if (clarityStatus) clarityStatus.classList.add('status-green');
        statusText = 'Clear & Aligned';
      } else if (clarityScore >= 40) {
        if (meterFill) meterFill.classList.add('meter-yellow');
        if (clarityStatus) clarityStatus.classList.add('status-yellow');
        statusText = 'Partial Clarity';
      } else {
        if (meterFill) meterFill.classList.add('meter-red');
        if (clarityStatus) clarityStatus.classList.add('status-red');
        statusText = 'Getting Started';
      }
      if (clarityStatus) clarityStatus.textContent = statusText;

      const locked = document.body.classList.contains("auth-locked");
      syncActionButtons(locked);

      const dimensionScores = {
        priorities: { checked: 0, total: 0 },
        deadlines: { checked: 0, total: 0 },
        resources: { checked: 0, total: 0 },
        expectations: { checked: 0, total: 0 }
      };

      window.itemCategories.forEach((category, index) => {
        Object.keys(dimensionConfig).forEach(dim => {
          if (dimensionConfig[dim].includes(category)) {
            dimensionScores[dim].total += 1;
            if (window.checkedItems[index]) dimensionScores[dim].checked += 1;
          }
        });
      });

      const prioritiesScore = dimensionScores.priorities.total ? Math.round((dimensionScores.priorities.checked / dimensionScores.priorities.total) * 100) : 0;
      const deadlinesScore  = dimensionScores.deadlines.total ? Math.round((dimensionScores.deadlines.checked  / dimensionScores.deadlines.total)  * 100) : 0;
      const resourcesScore  = dimensionScores.resources.total ? Math.round((dimensionScores.resources.checked  / dimensionScores.resources.total)  * 100) : 0;
      const expectationsScore = dimensionScores.expectations.total ? Math.round((dimensionScores.expectations.checked / dimensionScores.expectations.total) * 100) : 0;

      const sp = document.getElementById('scorePriorities');
      const sd = document.getElementById('scoreDeadlines');
      const sr = document.getElementById('scoreResources');
      const se = document.getElementById('scoreExpectations');

      if (sp) sp.textContent = prioritiesScore + '%';
      if (sd) sd.textContent = deadlinesScore + '%';
      if (sr) sr.textContent = resourcesScore + '%';
      if (se) se.textContent = expectationsScore + '%';
    }

    window.updateClarityScore = updateClarityScore;

    /* ===========================
       EVIDENCE SUMMARY
    =========================== */
    function generateSmartSummary() {
      const checkedCount = getCheckedCount();
      const totalCount = window.checkedItems.length;
      const clarityScore = totalCount > 0 ? Math.round((checkedCount / totalCount) * 100) : 0;

      document.getElementById('summaryScore').textContent = clarityScore + '%';

      let statusText = 'Getting Started';
      if (clarityScore >= 75) statusText = 'Clear & Aligned';
      else if (clarityScore >= 40) statusText = 'Partial Clarity';
      document.getElementById('summaryStatus').textContent = statusText;

      document.getElementById('evidenceSummary').classList.add('active');
      document.getElementById('evidenceSummary').scrollIntoView({ behavior: 'smooth' });

      generateRedFlags();
      generateNextSteps(clarityScore);
      generateRecommendedResources();
    }

    function generateRedFlags() {
      const redFlagsGrid = document.getElementById('redFlagsGrid');
      if (!redFlagsGrid) return;
      redFlagsGrid.innerHTML = '';

      const redFlags = [];
      const uncheckedCategories = {};
      
      window.checkedItems.forEach((checked, index) => {
        if (!checked) {
          const category = window.itemCategories[index];
          uncheckedCategories[category] = (uncheckedCategories[category] || 0) + 1;
        }
      });

      if (uncheckedCategories['priorities']) {
        redFlags.push({
          title: 'Unclear Priorities',
          description: 'You are unclear about your top priorities, which can lead to working on the wrong things and missing important deadlines.',
          icon: 'fas fa-bullseye'
        });
      }

      if (uncheckedCategories['quality']) {
        redFlags.push({
          title: 'Ambiguous Quality Standards',
          description: 'Unclear expectations about what "good" looks like can lead to rework and misalignment with manager expectations.',
          icon: 'fas fa-star'
        });
      }

      if (uncheckedCategories['deadlines']) {
        redFlags.push({
          title: 'Unclear Deadlines',
          description: 'Not knowing real deadlines increases risk of late delivery and stakeholder disappointment.',
          icon: 'fas fa-clock'
        });
      }

      if (uncheckedCategories['resources']) {
        redFlags.push({
          title: 'Resource Gaps',
          description: 'Missing resources or access will block progress and cause unnecessary delays.',
          icon: 'fas fa-unlock'
        });
      }

      if (uncheckedCategories['communication']) {
        redFlags.push({
          title: 'Communication Gaps',
          description: 'Unclear about update expectations can lead to micro-management or lack of visibility.',
          icon: 'fas fa-comment-alt'
        });
      }

      if (uncheckedCategories['hidden-tasks']) {
        redFlags.push({
          title: 'Hidden Expectations',
          description: 'Unwritten expectations often surface later, causing scope creep and additional work.',
          icon: 'fas fa-eye-slash'
        });
      }

      const uncheckedCount = window.checkedItems.filter(item => !item).length;
      if (uncheckedCount >= 4 && redFlags.length === 0) {
        redFlags.push({
          title: 'General Clarity Issues',
          description: 'Multiple areas need clarification, indicating potential misalignment with your manager.',
          icon: 'fas fa-exclamation'
        });
      }

      if (redFlags.length === 0) {
        redFlags.push({
          title: 'No Major Red Flags',
          description: 'Excellent! Your workload clarity is strong. Focus on maintaining this clarity through regular check-ins.',
          icon: 'fas fa-check-circle'
        });
      }

      while (redFlags.length < 3) {
        if (redFlags.length === 1) {
          redFlags.push({
            title: 'Minor Communication Gaps',
            description: 'Some uncertainty about update frequency or format could lead to misalignment.',
            icon: 'fas fa-comment'
          });
        } else {
          redFlags.push({
            title: 'Potential Scope Issues',
            description: 'Unclear boundaries on what\'s included in key tasks may cause scope creep.',
            icon: 'fas fa-expand'
          });
        }
      }

      redFlags.slice(0, 3).forEach((flag) => {
        const card = document.createElement('div');
        card.className = 'red-flag-card';
        card.innerHTML = `
          <div class="flag-icon"><i class="${flag.icon}"></i></div>
          <h4 class="flag-title">${flag.title}</h4>
          <p class="flag-description">${flag.description}</p>
        `;
        redFlagsGrid.appendChild(card);
      });
    }

    function generateNextSteps(clarityScore) {
      const nextStepsGrid = document.getElementById('nextStepsGrid');
      if (!nextStepsGrid) return;
      nextStepsGrid.innerHTML = '';

      let steps = [];

      if (clarityScore >= 75) {
        steps = [
          {
            title: 'Schedule Weekly Check-in',
            description: 'Book a 15-minute weekly sync with your manager to maintain alignment and prevent drift.',
            icon: 'fas fa-calendar-check'
          },
          {
            title: 'Document Your Process',
            description: 'Create a brief guide outlining how you achieve clarity to help teammates.',
            icon: 'fas fa-file-alt'
          },
          {
            title: 'Mentor a Colleague',
            description: 'Help someone else improve their workload clarity using this checklist.',
            icon: 'fas fa-users'
          }
        ];
      } else if (clarityScore >= 40) {
        steps = [
          {
            title: 'Schedule Alignment Meeting',
            description: 'Book 30 minutes with your manager this week to clarify priorities and expectations.',
            icon: 'fas fa-handshake'
          },
          {
            title: 'Prepare Clarifying Questions',
            description: 'List your top 3 areas needing clarification before the meeting.',
            icon: 'fas fa-question-circle'
          },
          {
            title: 'Create Priority Document',
            description: 'Draft a shared document outlining agreed priorities and success criteria.',
            icon: 'fas fa-tasks'
          }
        ];
      } else {
        steps = [
          {
            title: 'Urgent Alignment Needed',
            description: 'Schedule meeting within 48 hours with manager to address critical clarity gaps.',
            icon: 'fas fa-exclamation-circle'
          },
          {
            title: 'Prepare Specific Questions',
            description: 'Focus on priorities, deadlines, and success criteria for key tasks.',
            icon: 'fas fa-list'
          },
          {
            title: 'Request Written Confirmation',
            description: 'Ask for email summary of agreed expectations to ensure alignment.',
            icon: 'fas fa-envelope'
          }
        ];
      }

      steps.forEach((step) => {
        const card = document.createElement('div');
        card.className = 'next-step-card';
        card.innerHTML = `
          <div class="step-icon"><i class="${step.icon}"></i></div>
          <h4 class="step-title">${step.title}</h4>
          <p class="step-description">${step.description}</p>
        `;
        nextStepsGrid.appendChild(card);
      });
    }

    function generateRecommendedResources() {
      const resourcesGrid = document.getElementById('resourcesGrid');
      if (!resourcesGrid) return;
      resourcesGrid.innerHTML = '';

      const uncheckedCategories = {};
      window.checkedItems.forEach((checked, index) => {
        if (!checked) {
          const category = window.itemCategories[index];
          uncheckedCategories[category] = (uncheckedCategories[category] || 0) + 1;
        }
      });

      let resources = [];

      resources.push({
        title: 'Priority Reset Playbook',
        description: 'A step-by-step reset to stop urgent noise hijacking important work with a defensible prioritisation approach.',
        icon: 'fas fa-th',
        link: '#'
      });

      if (uncheckedCategories['communication'] || uncheckedCategories['expectations']) {
        resources.push({
          title: 'Expectation Alignment Checklist',
          description: 'Lock weekly alignment into clear outcomes, owners, timelines and "what good looks like", without it turning into waffle.',
          icon: 'fas fa-comments',
          link: '#'
        });
      } else {
        resources.push({
          title: 'Strategic Conversations Guide',
          description: 'Run meetings that land decisions: agenda, framing, crisp messaging, and follow-ups that actually stick.',
          icon: 'fas fa-clock',
          link: '#'
        });
      }

      if (uncheckedCategories['deadlines'] || uncheckedCategories['urgency']) {
        resources.push({
          title: 'Decision Clarity Checklist',
          description: 'Separate true deadlines from assumed pressure, clarify what\'s actually fixed, what\'s flexible, and what needs a decision now.',
          icon: 'fas fa-calendar-alt',
          link: '#'
        });
      } else {
        resources.push({
          title: 'Time Blocking Template',
          description: 'Schedule template to protect focus time for priority work.',
          icon: 'fas fa-calendar',
          link: '#'
        });
      }

      if (resources.length < 3) {
        resources.push({
          title: 'Overload and Capacity Planner',
          description: 'Convert workload into capacity reality, what fits, what breaks, and what must change to stay sustainable.',
          icon: 'fas fa-calculator',
          link: '#'
        });
      }

      if (resources.length < 3) {
        resources.push({
          title: 'Stakeholder Map',
          description: 'Visual tool to identify who needs what and when.',
          icon: 'fas fa-users',
          link: '#'
        });
      }

      resources.slice(0, 3).forEach(resource => {
        const card = document.createElement('div');
        card.className = 'resource-card';
        card.innerHTML = `
          <div class="resource-icon"><i class="${resource.icon}"></i></div>
          <h4 class="resource-title">${resource.title}</h4>
          <p class="resource-description">${resource.description}</p>
          <a href="${resource.link}" class="resource-link">
            Access Resource <i class="fas fa-arrow-right"></i>
          </a>
        `;
        resourcesGrid.appendChild(card);
      });
    }

    /* ===========================
       PRINT / SAVE PDF
    =========================== */
    function printChecklistPDF() {
      window.print();
      window.__tep_printed = true;
    }

    /* ===========================
       CLEAR ALL
    =========================== */
    function clearAllChecklist() {
      const items = document.querySelectorAll('.checklist-item');
      items.forEach((container, index) => {
        const icon = container.querySelector('i');
        if (!icon) return;
        icon.classList.remove('fa-check-square');
        if (!icon.classList.contains('fa-square')) icon.classList.add('fa-square');
        icon.style.color = '#7B5FC4';
        window.checkedItems[index] = false;
        container.setAttribute("aria-pressed", "false");
      });

      const report = document.getElementById('evidenceSummary');
      if (report) report.classList.remove('active');

      updateClarityScore();
      markUnsaved();
      window.scrollTo({ top: 0, behavior: 'smooth' });

      window.__tep_cleared = true;
    }

    /* ===========================
       MY PLAYBOOK (LOCALSTORAGE)
    =========================== */
    const PLAYBOOK_KEY = 'tepSavedItems';
    const CURRENT_TOOL_ID = 'workload-clarity-checklist';
    const CURRENT_TOOL_TITLE = 'Workload Clarity Checklist';
    const CURRENT_TOOL_TYPE = 'Tool';

    function getSavedItems() {
      try {
        const raw = localStorage.getItem(PLAYBOOK_KEY);
        if (!raw) return [];
        const parsed = JSON.parse(raw);
        return Array.isArray(parsed) ? parsed : [];
      } catch (e) {
        return [];
      }
    }

    function setSavedItems(items) {
      try { localStorage.setItem(PLAYBOOK_KEY, JSON.stringify(items)); }
      catch (e) {}
    }

    function openPlaybookUI() {
      const overlay = document.getElementById('playbookOverlay');
      const sidebar = document.getElementById('playbookSidebar');
      if (overlay && sidebar) {
        overlay.classList.add('open');
        sidebar.classList.add('open');
      }
    }

    function closePlaybookUI() {
      const overlay = document.getElementById('playbookOverlay');
      const sidebar = document.getElementById('playbookSidebar');
      if (overlay && sidebar) {
        overlay.classList.remove('open');
        sidebar.classList.remove('open');
      }
    }

    function wireHeaderMyPlaybookHooks() {
      const myPlaybookMobileTab = document.getElementById('mobileMyPlaybookTab');
      if (!myPlaybookMobileTab) return;

      myPlaybookMobileTab.addEventListener('click', (e) => {
        e.preventDefault();
        openPlaybookUI();

        const navLinks = document.querySelector('.nav-links');
        const mobileToggle = document.getElementById("mobileToggle");
        if (navLinks && navLinks.classList.contains('active')) {
          navLinks.classList.remove('active');
          if (mobileToggle) mobileToggle.setAttribute("aria-expanded", "false");
          const icon = document.querySelector('.mobile-toggle i');
          if (icon) {
            icon.classList.add('fa-bars');
            icon.classList.remove('fa-times');
          }
        }
      });
    }

    function initializePlaybook() {
      const playbookOverlay = document.getElementById('playbookOverlay');
      const playbookSidebar = document.getElementById('playbookSidebar');
      const playbookButton = document.getElementById('myPlaybookButton');
      const closeBtn = document.getElementById('closePlaybook');
      const saveItemBtn = document.getElementById('saveBtn');

      if (!playbookOverlay || !playbookSidebar || !playbookButton || !closeBtn || !saveItemBtn) return;

      renderSavedItems();

      const savedItems = getSavedItems();
      const isAlreadySaved = savedItems.some(item => item.id === CURRENT_TOOL_ID);
      updateSaveButtonState(saveItemBtn, isAlreadySaved);

      saveItemBtn.addEventListener('click', () => {
        const items = getSavedItems();
        const index = items.findIndex(item => item.id === CURRENT_TOOL_ID);
        let nowSaved;

        if (index === -1) {
          const toolLink = window.location.pathname.split('/').pop() || 'workload-clarity-checklist.html';
          items.push({
            id: CURRENT_TOOL_ID,
            title: CURRENT_TOOL_TITLE,
            type: CURRENT_TOOL_TYPE,
            link: toolLink,
            savedAt: new Date().toISOString()
          });
          nowSaved = true;
        } else {
          items.splice(index, 1);
          nowSaved = false;
        }

        setSavedItems(items);
        updateSaveButtonState(saveItemBtn, nowSaved);
        renderSavedItems();
      });

      playbookButton.addEventListener('click', openPlaybookUI);
      closeBtn.addEventListener('click', closePlaybookUI);

      playbookOverlay.addEventListener('click', (e) => {
        if (e.target === playbookOverlay) closePlaybookUI();
      });
    }

    function wireFabKeyboard() {
      const fab = document.getElementById("myPlaybookButton");
      if (!fab) return;
      fab.addEventListener("keydown", (e) => {
        if (e.key === "Enter" || e.key === " ") {
          e.preventDefault();
          openPlaybookUI();
        }
      });
    }

    function updateSaveButtonState(button, isSaved) {
      if (!button) return;
      const icon = button.querySelector('i');
      const label = button.querySelector('span');

      if (isSaved) {
        button.classList.add('saved');
        if (icon) { icon.classList.remove('far'); icon.classList.add('fas'); }
        if (label) label.textContent = 'Saved';
      } else {
        button.classList.remove('saved');
        if (icon) { icon.classList.remove('fas'); icon.classList.add('far'); }
        if (label) label.textContent = 'Save item';
      }
    }

    function renderSavedItems() {
      const listEl = document.getElementById('savedItemsList');
      const emptyEl = document.getElementById('savedItemsEmpty');
      if (!listEl || !emptyEl) return;

      const items = getSavedItems();
      listEl.innerHTML = '';

      if (!items.length) {
        emptyEl.style.display = 'block';
        return;
      }

      emptyEl.style.display = 'none';

      items.forEach(item => {
        const li = document.createElement('li');
        li.className = 'saved-item';
        const savedDate = item.savedAt ? new Date(item.savedAt) : null;
        const dateText = savedDate
          ? savedDate.toLocaleDateString('en-GB', { day: '2-digit', month: 'short', year: 'numeric' })
          : '';

        li.innerHTML = `
          <div class="saved-item-title-row">
            <span class="saved-item-title">${item.title}</span>
            <span class="saved-item-type">${item.type}</span>
          </div>
          <div class="saved-item-meta">${dateText ? `Saved on ${dateText}` : ''}</div>
          <a class="saved-item-link" href="${item.link}">
            Open <i class="fas fa-arrow-right"></i>
          </a>
        `;
        listEl.appendChild(li);
      });
    }
  </script>

  <!-- ✅ ONE unified Supabase module -->
  <script type="module">
    import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";

    const SB_URL = window.TEP_SUPABASE_URL;
    const SB_KEY = window.TEP_SUPABASE_ANON_KEY;
    const supabase = (SB_URL && SB_KEY) ? createClient(SB_URL, SB_KEY) : null;

    const TOOL_ID = "workload-clarity-checklist";
    const TOOL_VERSION = 1;

    function initialsFrom(fullName, email) {
      const name = (fullName || "").trim();
      if (name) {
        const parts = name.split(/\s+/).filter(Boolean);
        const a = parts[0]?.[0] || "";
        const b = parts.length > 1 ? (parts[parts.length - 1]?.[0] || "") : "";
        const init = (a + b).toUpperCase();
        return init || "ME";
      }
      const em = (email || "").trim();
      if (em) return em.slice(0, 2).toUpperCase();
      return "ME";
    }

    async function getAuthedUser() {
      try {
        if (!supabase) return null;
        const { data } = await supabase.auth.getUser();
        return data?.user || null;
      } catch (e) {
        return null;
      }
    }

    const toolMain = document.getElementById("toolMain");
    const initialsBtn = document.getElementById("userInitialsBtn");
    const mobileProfileBtn = document.getElementById("mobileProfileBtn");
    const logoutBtn = document.getElementById("logoutBtn");
    const authOverlay = document.getElementById("authLockOverlay");
    const saveProgressBtn = document.getElementById("saveProgressBtn");

    async function safeLogActivity(event_name, meta = {}) {
      try {
        if (!supabase) return;
        const user = await getAuthedUser();
        if (!user) return;

        await supabase.from("activity_log").insert([{
          user_id: user.id,
          event_name,
          meta,
          created_at: new Date().toISOString()
        }]);
      } catch (e) {}
    }

    function isLocked() {
      return document.body.classList.contains("auth-locked");
    }

    function setToolInert(locked) {
      try {
        if (toolMain) toolMain.toggleAttribute("inert", !!locked);
      } catch (e) {}
    }

    function captureBlocker(e) {
      if (!isLocked()) return;
      const inAuth = e.target && (e.target.closest ? e.target.closest("#authLockOverlay") : null);
      if (inAuth) return;

      e.preventDefault();
      e.stopPropagation();
    }

    function keyBlocker(e) {
      if (!isLocked()) return;
      const inAuth = e.target && (e.target.closest ? e.target.closest("#authLockOverlay") : null);
      if (inAuth) return;

      const blockKeys = ["Tab","Enter"," ","ArrowUp","ArrowDown","ArrowLeft","ArrowRight"];
      if (blockKeys.includes(e.key)) {
        e.preventDefault();
        e.stopPropagation();
      }
    }

    document.addEventListener("click", captureBlocker, true);
    document.addEventListener("pointerdown", captureBlocker, true);
    document.addEventListener("keydown", keyBlocker, true);

    function setToolLocked(locked) {
      document.body.classList.toggle("auth-locked", !!locked);

      if (authOverlay) {
        authOverlay.classList.toggle("active", !!locked);
        authOverlay.setAttribute("aria-hidden", locked ? "false" : "true");
      }

      setToolInert(locked);

      if (typeof window.syncActionButtons === "function") {
        window.syncActionButtons(locked);
      }
    }

    function setSignedOutHeader() {
      if (initialsBtn) {
        initialsBtn.textContent = "…";
        initialsBtn.href = "./sign-in.html";
      }
      if (mobileProfileBtn) mobileProfileBtn.href = "./sign-in.html";
      if (logoutBtn) logoutBtn.style.display = "none";
    }

    function setSignedInHeader({ initials }) {
      if (initialsBtn) {
        initialsBtn.textContent = initials || "ME";
        initialsBtn.href = "profile.html";
      }
      if (mobileProfileBtn) mobileProfileBtn.href = "profile.html";
      if (logoutBtn) logoutBtn.style.display = "inline-flex";
    }

    async function getUserName(user) {
      const fallbackName =
        user?.user_metadata?.full_name ||
        user?.user_metadata?.name ||
        "";

      try {
        const { data, error } = await supabase
          .from("profiles")
          .select("full_name")
          .eq("id", user.id)
          .maybeSingle();

        if (!error && data) {
          return (data.full_name || fallbackName);
        }
      } catch (e) {}

      return fallbackName;
    }

    function getLocalSnapshot() {
      return {
        tool_id: TOOL_ID,
        version: TOOL_VERSION,
        updated_at: new Date().toISOString(),
        checkedItems: Array.isArray(window.checkedItems) ? window.checkedItems : []
      };
    }

    function applySnapshot(snapshot) {
      try {
        const arr = snapshot?.checkedItems;
        if (!Array.isArray(arr)) return;

        const items = document.querySelectorAll(".checklist-item");
        const max = Math.min(items.length, arr.length);

        if (!Array.isArray(window.checkedItems) || window.checkedItems.length !== items.length) {
          window.checkedItems = new Array(items.length).fill(false);
        }

        for (let i = 0; i < max; i++) {
          const container = items[i];
          const icon = container?.querySelector("i");
          const checked = !!arr[i];

          window.checkedItems[i] = checked;

          if (!container) continue;
          container.setAttribute("aria-pressed", checked ? "true" : "false");

          if (!icon) continue;

          if (checked) {
            icon.classList.remove("fa-square");
            icon.classList.add("fa-check-square");
            icon.style.color = "#5A4496";
          } else {
            icon.classList.remove("fa-check-square");
            icon.classList.add("fa-square");
            icon.style.color = "#7B5FC4";
          }
        }

        if (typeof window.updateClarityScore === "function") {
          window.updateClarityScore();
        }
      } catch (e) {}
    }

    async function loadToolStateFromCloud(user) {
      if (!supabase || !user) return;

      try {
        const { data, error } = await supabase
          .from("tool_states")
          .select("state")
          .eq("user_id", user.id)
          .eq("tool_id", TOOL_ID)
          .order("updated_at", { ascending: false })
          .limit(1)
          .maybeSingle();

        if (error || !data?.state) {
          if (typeof window.markNeutral === "function") window.markNeutral();
          return;
        }

        applySnapshot(data.state);

        if (typeof window.markLoaded === "function") window.markLoaded();
      } catch (e) {
        if (typeof window.markNeutral === "function") window.markNeutral();
      }
    }

    async function saveToolStateToCloud(user) {
      if (!supabase || !user) return { ok: false, message: "Not signed in." };

      const snapshot = getLocalSnapshot();

      try {
        const { error } = await supabase
          .from("tool_states")
          .upsert([{
            user_id: user.id,
            tool_id: TOOL_ID,
            tool_version: TOOL_VERSION,
            state: snapshot,
            updated_at: new Date().toISOString()
          }], { onConflict: "user_id,tool_id" });

        if (error) return { ok: false, message: error.message || "Save failed." };

        return { ok: true, message: "Progress saved to your account.", at: snapshot.updated_at };
      } catch (e) {
        return { ok: false, message: "Save failed." };
      }
    }

    async function softCheckTables(user) {
      try {
        if (!supabase || !user) return;
        await supabase.from("profiles").select("id").eq("id", user.id).limit(1);
        await supabase.from("tool_states").select("tool_id").eq("user_id", user.id).limit(1);
      } catch (e) {}
    }

    async function handleSignedOut() {
      setSignedOutHeader();
      setToolLocked(true);
      if (typeof window.setSaveStatus === "function") window.setSaveStatus("", "info");
    }

    async function handleSignedIn(user) {
      const full_name = await getUserName(user);
      const initials = initialsFrom(full_name, user.email);

      setSignedInHeader({ initials });
      setToolLocked(false);

      if (saveProgressBtn) saveProgressBtn.disabled = false;

      if (typeof window.updateClarityScore === "function") {
        window.updateClarityScore();
      }

      await loadToolStateFromCloud(user);

      if (typeof window.updateClarityScore === "function") {
        window.updateClarityScore();
      }

      await softCheckTables(user);
      await safeLogActivity("tool_opened", { tool_id: TOOL_ID, tool_version: TOOL_VERSION });
    }

    async function initAuthAndLock() {
      if (!supabase) {
        setSignedOutHeader();
        setToolLocked(true);
        if (typeof window.setSaveStatus === "function") window.setSaveStatus("Missing Supabase config.", "err");
        return;
      }

      const user = await getAuthedUser();
      if (!user) {
        await handleSignedOut();
      } else {
        await handleSignedIn(user);
      }

      supabase.auth.onAuthStateChange(async (_event, session) => {
        const u = session?.user || null;
        if (!u) await handleSignedOut();
        else await handleSignedIn(u);
      });
    }

    async function wireLogout() {
      if (!logoutBtn) return;
      logoutBtn.addEventListener("click", async (e) => {
        e.preventDefault();
        if (!supabase) return;
        try {
          await safeLogActivity("logout_clicked", { tool_id: TOOL_ID });
          await supabase.auth.signOut();
          window.location.href = "./sign-in.html";
        } catch (e2) {
          window.location.href = "./sign-in.html";
        }
      });
    }

    async function wireSaveProgress() {
      if (!saveProgressBtn) return;

      saveProgressBtn.addEventListener("click", async () => {
        if (typeof window.setSaveStatus === "function") window.setSaveStatus("Saving…", "info");
        saveProgressBtn.disabled = true;

        const user = await getAuthedUser();
        if (!user) {
          if (typeof window.setSaveStatus === "function") window.setSaveStatus("Please sign in to save.", "err");
          setToolLocked(true);
          saveProgressBtn.disabled = false;
          return;
        }

        const res = await saveToolStateToCloud(user);
        if (res.ok) {
          if (typeof window.markSaved === "function") window.markSaved(res.at);
          await safeLogActivity("tool_saved", { tool_id: TOOL_ID, tool_version: TOOL_VERSION });
        } else {
          if (typeof window.setSaveStatus === "function") window.setSaveStatus(res.message || "Save failed.", "err");
        }

        saveProgressBtn.disabled = false;
      });
    }

    function wirePrintAndClearTelemetry() {
      const printBtn = document.getElementById("printBtn");
      const clearBtn = document.getElementById("clearBtn");

      if (printBtn) {
        printBtn.addEventListener("click", async () => {
          const user = await getAuthedUser();
          if (user) await safeLogActivity("tool_printed", { tool_id: TOOL_ID, tool_version: TOOL_VERSION });
        });
      }

      if (clearBtn) {
        clearBtn.addEventListener("click", async () => {
          const user = await getAuthedUser();
          if (user) await safeLogActivity("tool_cleared", { tool_id: TOOL_ID, tool_version: TOOL_VERSION });
        });
      }
    }

    wireLogout();
    wireSaveProgress();
    wirePrintAndClearTelemetry();
    initAuthAndLock();
  </script>

</body>
</html>
